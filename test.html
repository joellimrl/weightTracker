<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weight Tracker</title>
    <link rel="stylesheet" href="./style.css" />
    <script>
      // Test dataset (CSV). app.js will use this instead of fetching from Google Sheets.
      // Generates 50 deterministic (seeded) points from Feb 22 → Sep 30, 2026.

      const pad2 = (n) => String(n).padStart(2, '0');
      const toDmyLocal = (d) => {
        const yyyy = d.getFullYear();
        const mm = d.getMonth() + 1;
        const dd = d.getDate();
        const hh = d.getHours();
        const min = d.getMinutes();
        return `${pad2(dd)}-${pad2(mm)}-${String(yyyy).padStart(4, '0')} ${pad2(hh)}:${pad2(min)}`;
      };

      // Tiny seeded PRNG (Mulberry32)
      function mulberry32(seed) {
        let t = seed >>> 0;
        return function () {
          t += 0x6d2b79f5;
          let x = Math.imul(t ^ (t >>> 15), 1 | t);
          x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
          return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
        };
      }

      const rand = mulberry32(20260222);

      const start = new Date(2026, 1, 22, 0, 0, 0, 0); // Feb 22, 2026
      const end = new Date(2026, 8, 30, 23, 59, 0, 0); // Sep 30, 2026
      const spanMs = end.getTime() - start.getTime();

      // Create 50 unique timestamps (ms) so app.js doesn't dedupe them away.
      const stamps = new Set();
      while (stamps.size < 50) {
        const t = start.getTime() + Math.floor(rand() * spanMs);
        // snap to minute to keep CSV neat
        const snapped = Math.floor(t / 60000) * 60000;
        stamps.add(snapped);
      }

      const ts = Array.from(stamps).sort((a, b) => a - b).map((ms) => new Date(ms));

      // Weight series with a gentle downward trend + noise.
      const w0 = 90.8;
      const w1 = 84.8;

      const rows = ['date,weight_kg'];
      for (let i = 0; i < ts.length; i++) {
        const tNorm = ts.length > 1 ? i / (ts.length - 1) : 1;
        const trend = w0 + (w1 - w0) * tNorm;
        const noise = (rand() - 0.5) * 1.2; // ±0.6kg
        const weight = Math.round((trend + noise) * 10) / 10;
        rows.push(`${toDmyLocal(ts[i])},${weight}`);
      }

      window.WT_TEST_CSV_TEXT = rows.join('\n') + '\n';
    </script>
    <script src="./chart.js" defer></script>
    <script src="./app.js" defer></script>
  </head>
  <body>
    <main class="container">
      <header class="header">
        <h1 class="title">Weight Tracker</h1>
      </header>

      <div class="cardsGrid" aria-label="Summary">
        <section class="card" aria-label="Current weight">
          <div class="row">
            <div>
              <div class="label">Current weight (kg)</div>
              <div id="currentWeight" class="value valueEditable" role="button" tabindex="0" aria-label="Current weight (click to edit)">—</div>
              <div id="currentMeta" class="meta">Loading…</div>
            </div>
            <div class="right">
            </div>
          </div>
        </section>

        <section class="card" aria-label="Progress">
          <div>
            <div class="label">Change from 90.8kg</div>
            <div id="currentLossPct" class="value">—</div>
          </div>
        </section>
      </div>

      <div class="cardsGrid" aria-label="Your stats">
        <section class="card" aria-label="Your weights">
          <div>
            <div class="label">Your weights</div>
            <div class="inputs">
              <label class="inputGroup">
                <span class="label">Your original (kg)</span>
                <input id="userOriginal" class="input" inputmode="decimal" placeholder="e.g. 90.8" />
              </label>
              <label class="inputGroup">
                <span class="label">Your current (kg)</span>
                <input id="userCurrent" class="input" inputmode="decimal" placeholder="e.g. 85.0" />
              </label>
            </div>
          </div>
        </section>

        <section class="card" aria-label="Your progress">
          <div>
            <div class="label">Your change</div>
            <div id="userLossPct" class="value">—</div>
            <div id="userCompare" class="meta"></div>
          </div>
        </section>
      </div>

      <section class="card" aria-label="Weight over time">
        <div class="chartHeader">
          <div class="label">Weight over time (kg)</div>
          <div id="rangeMeta" class="meta"></div>
        </div>

        <div class="chartWrap">
          <svg id="chart" class="chart" viewBox="0 0 1000 320" preserveAspectRatio="none" role="img" aria-label="Weight chart">
            <defs>
              <linearGradient id="areaFill" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="rgba(134,168,255,0.25)" />
                <stop offset="100%" stop-color="rgba(134,168,255,0.02)" />
              </linearGradient>
            </defs>
            <g id="grid" class="grid"></g>
            <path id="area" class="area" d="" />
            <path id="line" class="line" d="" />
          </svg>
        </div>

        <div id="error" class="error" hidden></div>
      </section>
    </main>
  </body>
</html>
